{"variants":[{"paths":["\/documentation\/openswiftui\/asyncrender"],"traits":[{"interfaceLanguage":"swift"}]}],"schemaVersion":{"major":0,"patch":0,"minor":3},"abstract":[{"type":"text","text":"Understand how OpenSwiftUI performs asynchronous rendering when hosted in UIKit views."}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/OpenSwiftUI\/documentation\/OpenSwiftUI\/AsyncRender"},"metadata":{"role":"collectionGroup","title":"Async Rendering in UIKit Integration","modules":[{"name":"OpenSwiftUI"}]},"sections":[],"kind":"article","hierarchy":{"paths":[["doc:\/\/OpenSwiftUI\/documentation\/OpenSwiftUI"]]},"primaryContentSections":[{"content":[{"type":"heading","level":2,"anchor":"Overview","text":"Overview"},{"type":"paragraph","inlineContent":[{"text":"OpenSwiftUI can perform view graph updates and display list rendering on a background thread to improve frame rates and reduce main thread blocking. This async rendering capability is particularly important for smooth animations.","type":"text"}]},{"level":2,"type":"heading","text":"Architecture","anchor":"Architecture"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The async rendering pipeline involves several key components:"}]},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"DisplayLink: Manages the render loop and switches between main thread and async thread rendering","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"ViewGraph: Provides ","type":"text"},{"code":"updateOutputsAsync","type":"codeVoice"},{"text":" to update the view graph on a background thread","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"UIHostingViewBase: Coordinates the rendering process and manages the display link"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"ViewRendererHost: Protocol that provides "},{"code":"render","type":"codeVoice"},{"type":"text","text":" and "},{"code":"renderAsync","type":"codeVoice"},{"type":"text","text":" methods"}],"type":"paragraph"}]}]},{"level":2,"type":"heading","text":"How Async Rendering Works","anchor":"How-Async-Rendering-Works"},{"level":3,"type":"heading","text":"The Rendering Flow","anchor":"The-Rendering-Flow"},{"type":"paragraph","inlineContent":[{"text":"When a view needs to update, the following sequence occurs:","type":"text"}]},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"DisplayLink"},{"text":" fires on a CADisplayLink callback","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"UIHostingViewBase.displayLinkTimer"},{"type":"text","text":" is called with the current timestamp"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"If ","type":"text"},{"code":"isAsyncThread","type":"codeVoice"},{"text":" is true, ","type":"text"},{"code":"ViewRendererHost.renderAsync","type":"codeVoice"},{"text":" is invoked","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"ViewGraph.updateOutputsAsync"},{"type":"text","text":" attempts to update outputs on the async thread"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"If successful, the display list is rendered asynchronously","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"If async update fails, rendering falls back to the main thread","type":"text"}],"type":"paragraph"}]}]},{"level":3,"type":"heading","text":"The Async Thread","anchor":"The-Async-Thread"},{"type":"paragraph","inlineContent":[{"text":"OpenSwiftUI creates a dedicated async rendering thread:","type":"text"}]},{"type":"codeListing","code":["thread.name = \"org.OpenSwiftUIProject.OpenSwiftUI.AsyncRenderer\"","thread.qualityOfService = .userInteractive"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"This thread runs a separate RunLoop and processes display link callbacks when async rendering is enabled."}]},{"level":2,"type":"heading","text":"Conditions for Async Rendering","anchor":"Conditions-for-Async-Rendering"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Async rendering is only possible when specific conditions are met. The "},{"type":"codeVoice","code":"updateOutputsAsync"},{"type":"text","text":" method checks:"}]},{"type":"codeListing","code":["guard _rootDisplayList.allowsAsyncUpdate(),","      hostPreferenceValues.allowsAsyncUpdate(),","      sizeThatFitsObservers.isEmpty || _rootLayoutComputer.allowsAsyncUpdate()","else {","    return nil","}"],"syntax":"swift"},{"level":3,"type":"heading","text":"Key Requirements","anchor":"Key-Requirements"},{"type":"orderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"hostPreferenceValues must be non-nil: This attribute is set during "},{"code":"instantiateOutputs","type":"codeVoice"},{"text":" when the view contains dynamic containers like ","type":"text"},{"code":"ForEach","type":"codeVoice"},{"text":" or conditional views (","type":"text"},{"code":"if","type":"codeVoice"},{"text":"\/","type":"text"},{"code":"else","type":"codeVoice"},{"text":")","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Attributes must allow async updates: An attribute allows async update when its value state does not contain both "},{"type":"codeVoice","code":"dirty"},{"type":"text","text":" and "},{"type":"codeVoice","code":"mainThread"},{"type":"text","text":" flags"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"No pending properties needing update: The hostâ€™s "},{"type":"codeVoice","code":"propertiesNeedingUpdate"},{"type":"text","text":" must be empty"}]}]},{"content":[{"inlineContent":[{"text":"No pending transactions: The view graph must not have pending transactions","type":"text"}],"type":"paragraph"}]}]},{"anchor":"The-hostPreferenceValues-Requirement","type":"heading","level":3,"text":"The hostPreferenceValues Requirement"},{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"type":"codeVoice","code":"hostPreferenceValues"},{"text":" is set during ","type":"text"},{"type":"codeVoice","code":"ViewGraph.instantiateOutputs"},{"text":":","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["hostPreferenceValues = WeakAttribute(outputs.preferences[HostPreferencesKey.self])"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"This only works when the view hierarchy contains a "},{"code":"DynamicContainer","type":"codeVoice"},{"type":"text","text":". Dynamic containers are created by:"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"code":"ForEach","type":"codeVoice"},{"text":" views","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Conditional content ("},{"type":"codeVoice","code":"if"},{"type":"text","text":"\/"},{"type":"codeVoice","code":"else"},{"type":"text","text":" statements)"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Optional view unwrapping"}]}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Without these dynamic elements, "},{"code":"hostPreferenceValues","type":"codeVoice"},{"type":"text","text":" remains nil and "},{"code":"allowsAsyncUpdate()","type":"codeVoice"},{"type":"text","text":" returns false."}]},{"anchor":"Examples","type":"heading","level":2,"text":"Examples"},{"anchor":"Views-That-Support-Async-Rendering","type":"heading","level":3,"text":"Views That Support Async Rendering"},{"type":"paragraph","inlineContent":[{"text":"Views with dynamic content like ","type":"text"},{"code":"ForEach","type":"codeVoice"},{"text":" enable async rendering:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["struct AsyncRenderExample: View {","    @State private var items = [6]","","    var body: some View {","        VStack(spacing: 10) {","            ForEach(items, id: \\.self) { item in","                Color.blue.opacity(Double(item) \/ 6.0)","                    .frame(height: 50)","                    .transition(.slide)","            }","        }","        .animation(.easeInOut(duration: 2), value: items)","        .onAppear {","            items.removeAll { $0 == 6 }","        }","    }","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"In this example, the "},{"type":"codeVoice","code":"ForEach"},{"type":"text","text":" creates a "},{"type":"codeVoice","code":"DynamicContainer"},{"type":"text","text":", which sets up the "},{"type":"codeVoice","code":"hostPreferenceValues"},{"type":"text","text":" attribute, enabling async rendering during the animation."}]},{"anchor":"Views-That-Cannot-Use-Async-Rendering","type":"heading","level":3,"text":"Views That Cannot Use Async Rendering"},{"type":"paragraph","inlineContent":[{"text":"Views without dynamic containers cannot use async rendering:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["struct NoAsyncRenderExample: View {","    @State private var showRed = false","","    var body: some View {","        VStack {","            Color(platformColor: showRed ? .red : .blue)","                .onAppear {","                    let animation = Animation.linear(duration: 5)","                        .logicallyComplete(after: 1)","                    withAnimation(animation, completionCriteria: .logicallyComplete) {","                        showRed.toggle()","                    } completion: {","                        print(\"Complete\")","                    }","                }","        }","    }","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"This view has no "},{"type":"codeVoice","code":"ForEach"},{"type":"text","text":" or conditional view structure. The color interpolation happens within a single view, so no "},{"type":"codeVoice","code":"DynamicContainer"},{"type":"text","text":" is created and "},{"type":"codeVoice","code":"hostPreferenceValues"},{"type":"text","text":" remains nil."}]},{"anchor":"Debugging-Tips","type":"heading","level":2,"text":"Debugging Tips"},{"type":"paragraph","inlineContent":[{"text":"To understand why async rendering is not enabled:","type":"text"}]},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Check if your view hierarchy contains "},{"type":"codeVoice","code":"ForEach"},{"type":"text","text":" or conditional views"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Verify that animations are not using completion handlers that require main thread coordination"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Use the environment variable "},{"code":"OPENSWIFTUI_PRINT_TREE=1","type":"codeVoice"},{"type":"text","text":" to inspect the display list structure"}]}]}]}],"kind":"content"}],"references":{"doc://OpenSwiftUI/documentation/OpenSwiftUI":{"type":"topic","identifier":"doc:\/\/OpenSwiftUI\/documentation\/OpenSwiftUI","url":"\/documentation\/openswiftui","title":"OpenSwiftUI","kind":"symbol","role":"collection","abstract":[{"type":"text","text":"Declare the user interface and behavior for your app on every platform."}]}}}